<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Выбор специалиста</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 0 auto;
      padding: 16px;
      background-color: #f5f5f5;
    }

    .back-button {
      display: inline-block;
      padding: 8px 16px;
      margin-bottom: 20px;
      background-color: #f0f0f0;
      border: none;
      border-radius: 20px;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    h2 {
      margin: 20px 0;
      color: #333;
      text-align: center;
    }

    .master-card {
      background: #ffffff;
      border: 1px solid #e0e0e0;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .master-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background-color: #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      flex-shrink: 0;
    }

    .master-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .master-info {
      flex-grow: 1;
      text-align: left;
    }

    .master-name {
      font-weight: bold;
      font-size: 16px;
      color: #333;
      margin-bottom: 4px;
    }

    .master-specialty {
      font-size: 14px;
      color: #666;
    }

    .select-button {
      background: none;
      border: 1px solid #e74c3c;
      color: #e74c3c;
      border-radius: 6px;
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .select-button:hover {
      background-color: #e74c3c;
      color: white;
    }

    .no-masters {
      color: #666;
      text-align: center;
      margin-top: 20px;
    }
  </style>
</head>
<body>

<button class="back-button" onclick="window.history.back()">← Назад</button>
<h2>Выберите специалиста</h2>

<div id="mastersContainer"></div>

<script>
  const urlParams = new URLSearchParams(window.location.search);
  const selectedDate = urlParams.get("date");
  const selectedTime = urlParams.get("time");

  const masters = [
    {
      id: 1,
      firstName: "Александр",
      lastName: "Петров",
      specialty: "Барбер",
      avatar: "https://randomuser.me/api/portraits/men/32.jpg"
    },
    {
      id: 2,
      firstName: "Дмитрий",
      lastName: "Иванов",
      specialty: "Стилист",
      avatar: "https://randomuser.me/api/portraits/men/44.jpg"
    }
  ];

  const bookings = JSON.parse(localStorage.getItem("bookingData") || "{}");

  const toMinutes = t => {
    const [h, m] = t.split(":").map(Number);
    return h * 60 + m;
  };

  const blockedTimes = [0, 15, 30].map(offset => {
    const total = toMinutes(selectedTime) + offset;
    const h = String(Math.floor(total / 60)).padStart(2, '0');
    const m = String(total % 60).padStart(2, '0');
    return `${h}:${m}`;
  });

  const mastersContainer = document.getElementById("mastersContainer");

  masters.forEach(master => {
    const specialistBookings = bookings[`${master.firstName} ${master.lastName}`] || {};
    const busy = specialistBookings[selectedDate] || [];

    const isFree = blockedTimes.every(t => !busy.includes(t));
    if (isFree) {
      const card = document.createElement("div");
      card.className = "master-card";

      // Аватар мастера
      const avatar = document.createElement("div");
      avatar.className = "master-avatar";
      avatar.innerHTML = `<img src="${master.avatar}" alt="${master.firstName}">`;

      // Информация о мастере
      const info = document.createElement("div");
      info.className = "master-info";
      info.innerHTML = `
        <div class="master-name">${master.firstName} ${master.lastName}</div>
        <div class="master-specialty">${master.specialty}</div>
      `;

      // Кнопка выбора
      const btn = document.createElement("button");
      btn.className = "select-button";
      btn.innerText = "Выбрать";
      btn.onclick = () => {
        // Добавляем запись
        const masterName = `${master.firstName} ${master.lastName}`;
        if (!bookings[masterName]) bookings[masterName] = {};
        if (!bookings[masterName][selectedDate]) bookings[masterName][selectedDate] = [];
        blockedTimes.forEach(t => bookings[masterName][selectedDate].push(t));
        localStorage.setItem("bookingData", JSON.stringify(bookings));

        window.location.href = "index.html";
      };

      card.appendChild(avatar);
      card.appendChild(info);
      card.appendChild(btn);
      mastersContainer.appendChild(card);
    }
  });

  if (mastersContainer.children.length === 0) {
    const noMasters = document.createElement("p");
    noMasters.className = "no-masters";
    noMasters.innerText = "На это время нет доступных специалистов.";
    mastersContainer.appendChild(noMasters);
  }
</script>

</body>
</html>